/* 
 * This file is auto-generated.
 * Do not edit this file manually.
 * Your changes will be overwritten during the next generation.
 */
package org.openapis.openapi.utils;

import java.io.IOException;
import java.io.InputStream;
import java.net.URISyntaxException;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.Collection;
import java.util.HashSet;
import java.util.Set;
import java.util.concurrent.CompletableFuture;

public class FastpixHTTPClient implements HTTPClient {
    private boolean debugLoggingEnabled = false;
    private static final FastpixLogger logger = FastpixLogger.getLogger(FastpixHTTPClient.class);
    private static boolean staticDebugLoggingEnabled = false;
    private static final Set<String> redactedHeaders = new HashSet<>();

    public FastpixHTTPClient() {
        this.debugLoggingEnabled = staticDebugLoggingEnabled;
    }
    
    @Override
    public HttpResponse<InputStream> send(HttpRequest request)
            throws IOException, InterruptedException, URISyntaxException {
        boolean shouldLog = debugLoggingEnabled || staticDebugLoggingEnabled;
        if (shouldLog) {
            logger.debug("Sending HTTP request: {} {}", request.method(), request.uri());
        }
        HttpResponse<InputStream> response = HTTPClient.client.send(request, HttpResponse.BodyHandlers.ofInputStream());
        if (shouldLog) {
            logger.debug("Received HTTP response: {} {}", response.statusCode(), response.uri());
        }
        return response;
    }

    @Override
    public CompletableFuture<HttpResponse<Blob>> sendAsync(HttpRequest request) {
        if (debugLoggingEnabled) {
            logger.debug("Sending async HTTP request: {} {}", request.method(), request.uri());
        }
        return HTTPClient.client.sendAsync(request, HttpResponse.BodyHandlers.ofPublisher())
                .thenApply(resp -> {
                    if (debugLoggingEnabled) {
                        logger.debug("Received async HTTP response: {} {}", resp.statusCode(), resp.uri());
                    }
                    return new ResponseWithBody<>(resp, Blob::from);
                });
    }

    @Override
    public void enableDebugLogging(boolean enabled) {
        this.debugLoggingEnabled = enabled;
    }

    @Override
    public boolean isDebugLoggingEnabled() {
        return debugLoggingEnabled || staticDebugLoggingEnabled;
    }
    
    /**
     * Sets debug logging for all new instances of FastpixHTTPClient.
     * @param enabled Whether to enable debug logging
     */
    public static void setDebugLogging(boolean enabled) {
        staticDebugLoggingEnabled = enabled;
    }
    
    /**
     * Sets the list of headers to redact in debug logs.
     * @param headers Collection of header names to redact
     */
    public static void setRedactedHeaders(Collection<String> headers) {
        redactedHeaders.clear();
        if (headers != null) {
            redactedHeaders.addAll(headers);
        }
    }
    
    /**
     * Gets the set of redacted headers.
     * @return Set of header names that should be redacted
     */
    public static Set<String> getRedactedHeaders() {
        return new HashSet<>(redactedHeaders);
    }
}

