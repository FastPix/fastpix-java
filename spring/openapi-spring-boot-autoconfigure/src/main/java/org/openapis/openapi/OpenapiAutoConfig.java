/* 
 * This file is auto-generated.
 * Do not edit this file manually.
 * Your changes will be overwritten during the next generation.
 */
package org.openapis.openapi;

import org.springframework.boot.autoconfigure.AutoConfiguration;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import java.util.concurrent.TimeUnit;

import java.lang.IllegalStateException;
import java.util.Optional;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import org.openapis.openapi.utils.BackoffStrategy;
import org.openapis.openapi.utils.HTTPClient;
import org.openapis.openapi.utils.RetryConfig;
import org.openapis.openapi.utils.FastpixHTTPClient;


/**
 * Spring Boot Auto Configuration for openapi SDK
 * This configuration class automatically configures the openapi SDK
 * when Spring Boot detects it on the classpath.
 */
@AutoConfiguration
@ConditionalOnClass(Fastpix.class)
@EnableConfigurationProperties(OpenapiAutoConfigProperties.class)
public class OpenapiAutoConfig {

    /**
     * Constructor.
     */
    public OpenapiAutoConfig() {
    }

    /**
     * Creates a RetryConfig bean from properties if retry is enabled.
     * 
     * @param properties the configuration properties
     * @return A configured RetryConfig instance
     */
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnProperty(prefix = "openapi.retry-config", name = "strategy")
    public RetryConfig retryConfig(OpenapiAutoConfigProperties properties) {
        OpenapiAutoConfigProperties.RetryConfig retryProps = properties.getRetryConfig();
        
        if (RetryConfig.Strategy.BACKOFF.equals(retryProps.getStrategy())) {
            OpenapiAutoConfigProperties.RetryConfig.Backoff backoff = retryProps.getBackoff();
            return RetryConfig.builder()
                .backoff(
                    BackoffStrategy.builder()
                        .initialInterval(backoff.getInitialInterval().toMillis(), TimeUnit.MILLISECONDS)
                        .maxInterval(backoff.getMaxInterval().toMillis(), TimeUnit.MILLISECONDS)
                        .maxElapsedTime(backoff.getMaxElapsedTime().toMillis(), TimeUnit.MILLISECONDS)
                        .baseFactor(backoff.getBaseFactor())
                        .jitterFactor(backoff.getJitterFactor())
                        .retryConnectError(backoff.isRetryConnectError())
                        .retryReadTimeoutError(backoff.isRetryReadTimeoutError())
                        .build()
                )
                .build();
        }
        
        // Default retry config for other strategies
        return RetryConfig.builder().build();
    }
    /**
     * Creates an HTTPClient bean if none exists.
     *
     * @param properties the configuration properties
     * @return A configured HTTPClient instance
     */
    @Bean
    @ConditionalOnMissingBean
    public HTTPClient httpClient(OpenapiAutoConfigProperties properties) {
        OpenapiAutoConfigProperties.HttpClient httpClientProps = properties.getHttpClient();

        if (httpClientProps != null) {
            // Configure debug logging
            FastpixHTTPClient.setDebugLogging(httpClientProps.isEnableDebugLogging());

            // Configure redacted headers
            if (httpClientProps.getRedactedHeaders() != null && !httpClientProps.getRedactedHeaders().isEmpty()) {
                FastpixHTTPClient.setRedactedHeaders(httpClientProps.getRedactedHeaders());
            }
        }

        return new FastpixHTTPClient();
    }
    /**
     * Creates a SecuritySource bean if none exists and security properties are configured.
     *
     * @param properties the configuration properties
     * @return A configured SecuritySource instance
     */
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnPropertyPrefix(prefix = "openapi.security")
    public SecuritySource securitySource(OpenapiAutoConfigProperties properties) {OpenapiAutoConfigProperties.Security securityProps = properties.getSecurity();
        org.openapis.openapi.models.components.Security.Builder securityBuilder = org.openapis.openapi.models.components.Security.builder();
        boolean hasAnySecurityConfiguration = false;
        // Build username security from direct properties (primitive value)
        if (securityProps.getUsername() != null) {
            securityBuilder.username(securityProps.getUsername());
            hasAnySecurityConfiguration = true;
        }
        // Build password security from direct properties (primitive value)
        if (securityProps.getPassword() != null) {
            securityBuilder.password(securityProps.getPassword());
            hasAnySecurityConfiguration = true;
        }
        
        if (!hasAnySecurityConfiguration) {
            throw new IllegalStateException("Security configuration is present but no security options are configured. " +
                "Please configure at least one security option in your application properties.");
        }
        
        return SecuritySource.of(securityBuilder.build());
    }

    /**
     * Creates the SDKConfiguration bean as the single source of truth for all SDK configuration.
     *
     * @param properties the configuration properties
     * @param httpClient the HTTP client bean
     * @param hooks the hooks bean
     * @param asyncHooks the async hooks bean
     * @param securitySource the security source bean (optional)
     * @param retryConfig the retry config bean (optional)
     * @return A configured SDKConfiguration instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SDKConfiguration sdkConfiguration(
            OpenapiAutoConfigProperties properties,
            HTTPClient httpClient,
            org.openapis.openapi.utils.Hooks hooks,
            org.openapis.openapi.utils.AsyncHooks asyncHooks,
            SecuritySource securitySource,
            Optional<RetryConfig> retryConfig) {
        
        SDKConfiguration sdkConfiguration = new SDKConfiguration();
        
        sdkConfiguration.setClient(httpClient);
        
        sdkConfiguration.setHooks(hooks);
        sdkConfiguration.setAsyncHooks(asyncHooks);
        sdkConfiguration.setSecuritySource(securitySource);
        
        if (properties.getServerUrl() != null) {
            sdkConfiguration.setServerUrl(properties.getServerUrl());
        }
        sdkConfiguration.setServerIdx(properties.getServerIdx());
        
        sdkConfiguration.setRetryConfig(retryConfig);
        
        return sdkConfiguration;
    }

    /**
     * Creates the main SDK bean using the configured SDKConfiguration.
     *
     * @param sdkConfiguration the configured SDKConfiguration bean
     * @return A configured Fastpix instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Fastpix fastpix(SDKConfiguration sdkConfiguration) {
        return new Fastpix(sdkConfiguration);
    }

    /**
     * Creates an AsyncHooks bean if none exists.
     * 
     * @return A configured AsyncHooks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public org.openapis.openapi.utils.AsyncHooks asyncHooks() {
        return new org.openapis.openapi.utils.AsyncHooks();
    }

    /**
     * Creates a ScheduledExecutorService for async retry operations if none exists.
     * 
     * @return A configured ScheduledExecutorService instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ScheduledExecutorService retryScheduler() {
        return Executors.newSingleThreadScheduledExecutor();
    }

    /**
     * Creates a Hooks configuration bean if none exists.
     *
     * @return A configured Hooks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public org.openapis.openapi.utils.Hooks hooks() {
        return new org.openapis.openapi.utils.Hooks();
    }
    /**
     * Creates a InputVideos sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured InputVideos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public InputVideos inputVideos(Fastpix fastpix) {
        return fastpix.inputVideos();
    }
    /**
     * Creates a ManageVideos sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured ManageVideos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ManageVideos manageVideos(Fastpix fastpix) {
        return fastpix.manageVideos();
    }
    /**
     * Creates a Videos sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Videos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Videos videos(Fastpix fastpix) {
        return fastpix.videos();
    }
    /**
     * Creates a AiFeatures sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured AiFeatures instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AiFeatures aiFeatures(Fastpix fastpix) {
        return fastpix.aiFeatures();
    }
    /**
     * Creates a InVideoAiFeatures sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured InVideoAiFeatures instance
     */
    @Bean
    @ConditionalOnMissingBean
    public InVideoAiFeatures inVideoAiFeatures(Fastpix fastpix) {
        return fastpix.inVideoAiFeatures();
    }
    /**
     * Creates a Playback sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Playback instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Playback playback(Fastpix fastpix) {
        return fastpix.playback();
    }
    /**
     * Creates a Playlists sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Playlists instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Playlists playlists(Fastpix fastpix) {
        return fastpix.playlists();
    }
    /**
     * Creates a Playlist sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Playlist instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Playlist playlist(Fastpix fastpix) {
        return fastpix.playlist();
    }
    /**
     * Creates a DrmConfigurations sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured DrmConfigurations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public DrmConfigurations drmConfigurations(Fastpix fastpix) {
        return fastpix.drmConfigurations();
    }
    /**
     * Creates a Streams sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Streams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Streams streams(Fastpix fastpix) {
        return fastpix.streams();
    }
    /**
     * Creates a ManageLiveStreams sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured ManageLiveStreams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ManageLiveStreams manageLiveStreams(Fastpix fastpix) {
        return fastpix.manageLiveStreams();
    }
    /**
     * Creates a ManageLiveStream sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured ManageLiveStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public ManageLiveStream manageLiveStream(Fastpix fastpix) {
        return fastpix.manageLiveStream();
    }
    /**
     * Creates a LiveStream sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured LiveStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public LiveStream liveStream(Fastpix fastpix) {
        return fastpix.liveStream();
    }
    /**
     * Creates a LivePlayback sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured LivePlayback instance
     */
    @Bean
    @ConditionalOnMissingBean
    public LivePlayback livePlayback(Fastpix fastpix) {
        return fastpix.livePlayback();
    }
    /**
     * Creates a LivePlaybacks sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured LivePlaybacks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public LivePlaybacks livePlaybacks(Fastpix fastpix) {
        return fastpix.livePlaybacks();
    }
    /**
     * Creates a SimulcastStream sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured SimulcastStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SimulcastStream simulcastStream(Fastpix fastpix) {
        return fastpix.simulcastStream();
    }
    /**
     * Creates a SimulcastStreams sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured SimulcastStreams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SimulcastStreams simulcastStreams(Fastpix fastpix) {
        return fastpix.simulcastStreams();
    }
    /**
     * Creates a Simulcasts sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Simulcasts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Simulcasts simulcasts(Fastpix fastpix) {
        return fastpix.simulcasts();
    }
    /**
     * Creates a SigningKeys sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured SigningKeys instance
     */
    @Bean
    @ConditionalOnMissingBean
    public SigningKeys signingKeys(Fastpix fastpix) {
        return fastpix.signingKeys();
    }
    /**
     * Creates a Views sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Views instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Views views(Fastpix fastpix) {
        return fastpix.views();
    }
    /**
     * Creates a Dimensions sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Dimensions instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Dimensions dimensions(Fastpix fastpix) {
        return fastpix.dimensions();
    }
    /**
     * Creates a Metrics sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Metrics instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Metrics metrics(Fastpix fastpix) {
        return fastpix.metrics();
    }
    /**
     * Creates a Errors sub-SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @return A configured Errors instance
     */
    @Bean
    @ConditionalOnMissingBean
    public Errors errors(Fastpix fastpix) {
        return fastpix.errors();
    }

    /**
     * Creates the async SDK bean if none exists.
     *
     * @param fastpix the main SDK instance
     * @param sdkConfiguration the configured SDKConfiguration bean
     * @return A configured AsyncFastpix instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncFastpix asyncFastpix(Fastpix fastpix, SDKConfiguration sdkConfiguration) {
        return new AsyncFastpix(fastpix, sdkConfiguration);
    }
    /**
     * Creates an AsyncInputVideos sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncInputVideos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncInputVideos asyncInputVideos(AsyncFastpix asyncFastpix) {
        return asyncFastpix.inputVideos();
    }
    /**
     * Creates an AsyncManageVideos sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncManageVideos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncManageVideos asyncManageVideos(AsyncFastpix asyncFastpix) {
        return asyncFastpix.manageVideos();
    }
    /**
     * Creates an AsyncVideos sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncVideos instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncVideos asyncVideos(AsyncFastpix asyncFastpix) {
        return asyncFastpix.videos();
    }
    /**
     * Creates an AsyncAiFeatures sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncAiFeatures instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncAiFeatures asyncAiFeatures(AsyncFastpix asyncFastpix) {
        return asyncFastpix.aiFeatures();
    }
    /**
     * Creates an AsyncInVideoAiFeatures sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncInVideoAiFeatures instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncInVideoAiFeatures asyncInVideoAiFeatures(AsyncFastpix asyncFastpix) {
        return asyncFastpix.inVideoAiFeatures();
    }
    /**
     * Creates an AsyncPlayback sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncPlayback instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncPlayback asyncPlayback(AsyncFastpix asyncFastpix) {
        return asyncFastpix.playback();
    }
    /**
     * Creates an AsyncPlaylists sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncPlaylists instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncPlaylists asyncPlaylists(AsyncFastpix asyncFastpix) {
        return asyncFastpix.playlists();
    }
    /**
     * Creates an AsyncPlaylist sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncPlaylist instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncPlaylist asyncPlaylist(AsyncFastpix asyncFastpix) {
        return asyncFastpix.playlist();
    }
    /**
     * Creates an AsyncDrmConfigurations sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncDrmConfigurations instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncDrmConfigurations asyncDrmConfigurations(AsyncFastpix asyncFastpix) {
        return asyncFastpix.drmConfigurations();
    }
    /**
     * Creates an AsyncStreams sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncStreams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncStreams asyncStreams(AsyncFastpix asyncFastpix) {
        return asyncFastpix.streams();
    }
    /**
     * Creates an AsyncManageLiveStreams sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncManageLiveStreams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncManageLiveStreams asyncManageLiveStreams(AsyncFastpix asyncFastpix) {
        return asyncFastpix.manageLiveStreams();
    }
    /**
     * Creates an AsyncManageLiveStream sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncManageLiveStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncManageLiveStream asyncManageLiveStream(AsyncFastpix asyncFastpix) {
        return asyncFastpix.manageLiveStream();
    }
    /**
     * Creates an AsyncLiveStream sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncLiveStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncLiveStream asyncLiveStream(AsyncFastpix asyncFastpix) {
        return asyncFastpix.liveStream();
    }
    /**
     * Creates an AsyncLivePlayback sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncLivePlayback instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncLivePlayback asyncLivePlayback(AsyncFastpix asyncFastpix) {
        return asyncFastpix.livePlayback();
    }
    /**
     * Creates an AsyncLivePlaybacks sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncLivePlaybacks instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncLivePlaybacks asyncLivePlaybacks(AsyncFastpix asyncFastpix) {
        return asyncFastpix.livePlaybacks();
    }
    /**
     * Creates an AsyncSimulcastStream sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncSimulcastStream instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSimulcastStream asyncSimulcastStream(AsyncFastpix asyncFastpix) {
        return asyncFastpix.simulcastStream();
    }
    /**
     * Creates an AsyncSimulcastStreams sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncSimulcastStreams instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSimulcastStreams asyncSimulcastStreams(AsyncFastpix asyncFastpix) {
        return asyncFastpix.simulcastStreams();
    }
    /**
     * Creates an AsyncSimulcasts sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncSimulcasts instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSimulcasts asyncSimulcasts(AsyncFastpix asyncFastpix) {
        return asyncFastpix.simulcasts();
    }
    /**
     * Creates an AsyncSigningKeys sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncSigningKeys instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncSigningKeys asyncSigningKeys(AsyncFastpix asyncFastpix) {
        return asyncFastpix.signingKeys();
    }
    /**
     * Creates an AsyncViews sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncViews instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncViews asyncViews(AsyncFastpix asyncFastpix) {
        return asyncFastpix.views();
    }
    /**
     * Creates an AsyncDimensions sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncDimensions instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncDimensions asyncDimensions(AsyncFastpix asyncFastpix) {
        return asyncFastpix.dimensions();
    }
    /**
     * Creates an AsyncMetrics sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncMetrics instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncMetrics asyncMetrics(AsyncFastpix asyncFastpix) {
        return asyncFastpix.metrics();
    }
    /**
     * Creates an AsyncErrors sub-SDK bean if none exists.
     *
     * @param asyncFastpix the async SDK instance
     * @return A configured AsyncErrors instance
     */
    @Bean
    @ConditionalOnMissingBean
    public AsyncErrors asyncErrors(AsyncFastpix asyncFastpix) {
        return asyncFastpix.errors();
    }
}